# Firestore ë³´ì•ˆ ê·œì¹™ ì ìš© ê°€ì´ë“œ

## ðŸš€ ë¹ ë¥¸ ì‹œìž‘ (5ë¶„ ì•ˆì— ì™„ë£Œ)

### 1ë‹¨ê³„: Firebase ì½˜ì†” ì ‘ì†
1. https://console.firebase.google.com/ ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì™¼ìª½ ë©”ë‰´ì—ì„œ **"Firestore Database"** í´ë¦­
4. ìƒë‹¨ íƒ­ì—ì„œ **"ê·œì¹™"** í´ë¦­

### 2ë‹¨ê³„: ê·œì¹™ ë³µì‚¬ ë° ë¶™ì—¬ë„£ê¸°

**ê°œë°œ/í…ŒìŠ¤íŠ¸ ë‹¨ê³„ (ê¶Œìž¥: ì²˜ìŒ ì‹œìž‘í•  ë•Œ)**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
```

**í”„ë¡œë•ì…˜ ë‹¨ê³„ (ê¶Œìž¥: ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ì‹œ) - ëˆ„êµ¬ë‚˜ ì§ˆë¬¸/ë‹µë³€ ìž‘ì„± ê°€ëŠ¥**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /questions/{subjectId}/items/{questionId} {
      // âœ… ëª¨ë“  ì‚¬ìš©ìžê°€ ì½ê¸° ê°€ëŠ¥
      allow read: if true;
      
      // âœ… ëˆ„êµ¬ë‚˜ ì§ˆë¬¸ ìž‘ì„± ê°€ëŠ¥ (ë°ì´í„° ê²€ì¦ í¬í•¨)
      allow create: if request.resource.data.keys().hasAll(['title', 'content', 'createdAt', 'answers'])
                    && request.resource.data.title is string
                    && request.resource.data.title.size() > 0
                    && request.resource.data.title.size() <= 200
                    && request.resource.data.content is string
                    && request.resource.data.content.size() > 0
                    && request.resource.data.content.size() <= 5000
                    && request.resource.data.answers is list;
      
      // âœ… ëˆ„êµ¬ë‚˜ ë‹µë³€ ì¶”ê°€ ê°€ëŠ¥ (ë‹µë³€ë§Œ ì¶”ê°€, ê¸°ì¡´ ë°ì´í„° ìˆ˜ì • ë¶ˆê°€)
      allow update: if request.resource.data.diff(resource.data).affectedKeys().hasOnly(['answers'])
                     && request.resource.data.answers.size() > resource.data.answers.size()
                     // ë‹µë³€ ë°ì´í„° ê²€ì¦
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].keys().hasAll(['id', 'content', 'createdAt'])
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content is string
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content.size() > 0
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content.size() <= 5000;
      
      // âŒ ì‚­ì œëŠ” í—ˆìš©í•˜ì§€ ì•ŠìŒ (ì•…ì˜ì ì¸ ì‚­ì œ ë°©ì§€)
      allow delete: if false;
    }
  }
}
```

**ë˜ëŠ” `firestore.rules` íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”.**

### 3ë‹¨ê³„: ê·œì¹™ ê²Œì‹œ
1. ê·œì¹™ íŽ¸ì§‘ê¸°ì—ì„œ ìœ„ì˜ ê·œì¹™ ì¤‘ í•˜ë‚˜ë¥¼ ë¶™ì—¬ë„£ê¸°
2. **"ê²Œì‹œ"** ë²„íŠ¼ í´ë¦­
3. í™•ì¸ ë©”ì‹œì§€ì—ì„œ **"ê²Œì‹œ"** í´ë¦­
4. ì™„ë£Œ! ðŸŽ‰

---

## ðŸ“‹ ìƒì„¸ ì„¤ëª…

### ê·œì¹™ êµ¬ì¡° ì´í•´í•˜ê¸°

```javascript
rules_version = '2';  // ê·œì¹™ ë²„ì „ (í•­ìƒ '2' ì‚¬ìš©)
service cloud.firestore {
  match /databases/{database}/documents {
    // ì—¬ê¸°ì— ê·œì¹™ ìž‘ì„±
  }
}
```

### ê²½ë¡œ ë§¤ì¹­

```
questions/{subjectId}/items/{questionId}
```

- `questions`: ìµœìƒìœ„ ì»¬ë ‰ì…˜
- `{subjectId}`: êµê³¼ëª© ID (korean, english, math, science)
- `items`: í•˜ìœ„ ì»¬ë ‰ì…˜
- `{questionId}`: ì§ˆë¬¸ ë¬¸ì„œ ID

---

## ðŸ”’ ë³´ì•ˆ ê·œì¹™ ì˜µì…˜ ìƒì„¸

### ì˜µì…˜ 1: í…ŒìŠ¤íŠ¸ ëª¨ë“œ
**ëª¨ë“  ì‚¬ìš©ìžê°€ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥**

âœ… **ìž¥ì **: ì„¤ì •ì´ ê°„ë‹¨í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€  
âš ï¸ **ë‹¨ì **: ë³´ì•ˆì´ ì—†ìŒ, í”„ë¡œë•ì…˜ì—ì„œ ì‚¬ìš© ê¸ˆì§€

### ì˜µì…˜ 2: ì œí•œëœ ì“°ê¸° (ê¶Œìž¥)
**ëª¨ë“  ì‚¬ìš©ìžê°€ ì½ê¸° ê°€ëŠ¥, ì“°ê¸°ëŠ” ê²€ì¦ë¨**

âœ… **ìž¥ì **: 
- ë°ì´í„° ë¬´ê²°ì„± ë³´ìž¥
- ì•…ì˜ì ì¸ ì‚­ì œ ë°©ì§€
- í¬ê¸° ì œí•œìœ¼ë¡œ ë¹„ìš© ì ˆê°

âœ… **ê²€ì¦ ë‚´ìš©**:
- í•„ìˆ˜ í•„ë“œ í™•ì¸ (title, content, createdAt, answers)
- ì œëª©: 1-200ìž
- ë‚´ìš©: 1-5000ìž
- ë‹µë³€ë§Œ ì¶”ê°€ ê°€ëŠ¥ (ê¸°ì¡´ ë°ì´í„° ìˆ˜ì • ë¶ˆê°€)
- ì‚­ì œ ë¶ˆê°€

---

## ðŸŽ¯ ë‹¨ê³„ë³„ ì ìš© ë°©ë²•

### ê°œë°œ ë‹¨ê³„ (ì§€ê¸ˆ ë°”ë¡œ ì ìš©)

1. **í…ŒìŠ¤íŠ¸ ëª¨ë“œ ê·œì¹™ ì‚¬ìš©**
   ```javascript
   match /{document=**} {
     allow read, write: if true;
   }
   ```

2. **ê²Œì‹œ í›„ í…ŒìŠ¤íŠ¸**
   - ì§ˆë¬¸ ìž‘ì„± í…ŒìŠ¤íŠ¸
   - ë‹µë³€ ìž‘ì„± í…ŒìŠ¤íŠ¸
   - ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì €ìž¥ë˜ëŠ”ì§€ í™•ì¸

### í”„ë¡œë•ì…˜ ë‹¨ê³„ (ì„œë¹„ìŠ¤ ì˜¤í”ˆ ì „)

1. **ì œí•œëœ ì“°ê¸° ê·œì¹™ ì‚¬ìš©**
   - ìœ„ì˜ "ì˜µì…˜ 2" ê·œì¹™ ë³µì‚¬
   - Firebase ì½˜ì†”ì— ë¶™ì—¬ë„£ê¸°
   - ê²Œì‹œ

2. **í…ŒìŠ¤íŠ¸**
   - ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ìž‘ë™í•˜ëŠ”ì§€ í™•ì¸
   - ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ í™•ì¸

---

## ðŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ: "Permission denied" ì˜¤ë¥˜

**ì›ì¸**: ë³´ì•ˆ ê·œì¹™ì´ ìš”ì²­ì„ ê±°ë¶€í•¨

**í•´ê²°**:
1. ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ê²Œì‹œë˜ì—ˆëŠ”ì§€ í™•ì¸
2. ê·œì¹™ ë¬¸ë²• ì˜¤ë¥˜ í™•ì¸ (ì½˜ì†”ì— ì˜¤ë¥˜ í‘œì‹œë¨)
3. ë°ì´í„° êµ¬ì¡°ê°€ ê·œì¹™ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

### ë¬¸ì œ: ì§ˆë¬¸ì€ ë˜ëŠ”ë° ë‹µë³€ì´ ì•ˆ ë¨

**ì›ì¸**: update ê·œì¹™ì´ ë„ˆë¬´ ì œí•œì ì¼ ìˆ˜ ìžˆìŒ

**í•´ê²°**: 
- í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ìž„ì‹œ ë³€ê²½í•˜ì—¬ í™•ì¸
- ê·œì¹™ì˜ update ì¡°ê±´ í™•ì¸

### ë¬¸ì œ: ê·œì¹™ ê²Œì‹œê°€ ì•ˆ ë¨

**ì›ì¸**: ë¬¸ë²• ì˜¤ë¥˜

**í•´ê²°**:
1. ê·œì¹™ íŽ¸ì§‘ê¸°ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
2. ê´„í˜¸, ë”°ì˜´í‘œ í™•ì¸
3. ê·œì¹™ ì˜ˆì‹œë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©

---

## ðŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ ë‹¨ê³„
- [ ] Firebase í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ
- [ ] Firestore ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ì™„ë£Œ
- [ ] í…ŒìŠ¤íŠ¸ ëª¨ë“œ ê·œì¹™ ì ìš©
- [ ] ì§ˆë¬¸ ìž‘ì„± í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] ë‹µë³€ ìž‘ì„± í…ŒìŠ¤íŠ¸ ì„±ê³µ

### í”„ë¡œë•ì…˜ ë‹¨ê³„
- [ ] ì œí•œëœ ì“°ê¸° ê·œì¹™ ì ìš©
- [ ] ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†” ì˜¤ë¥˜ í™•ì¸ ì™„ë£Œ
- [ ] ë°ì´í„° ë¬´ê²°ì„± í™•ì¸ ì™„ë£Œ

---

## ðŸ’¡ ì¶”ê°€ íŒ

1. **ê·œì¹™ ì‹œë®¬ë ˆì´ì…˜ ì‚¬ìš©**
   - ê·œì¹™ íƒ­ì—ì„œ "ì‹œë®¬ë ˆì´ì…˜" ê¸°ëŠ¥ ì‚¬ìš©
   - ê·œì¹™ì„ ê²Œì‹œí•˜ê¸° ì „ì— í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

2. **ê·œì¹™ ë²„ì „ ê´€ë¦¬**
   - ê·œì¹™ì„ ë³€ê²½í•˜ê¸° ì „ì— ë°±ì—…
   - ë³€ê²½ ì´ë ¥ ê´€ë¦¬

3. **ëª¨ë‹ˆí„°ë§**
   - Firebase ì½˜ì†” â†’ Firestore â†’ ì‚¬ìš©ëŸ‰ íƒ­
   - ê±°ë¶€ëœ ìš”ì²­ í™•ì¸

---

## ðŸ“š ê´€ë ¨ íŒŒì¼

- `firestore.rules`: í”„ë¡œë•ì…˜ìš© ê·œì¹™ íŒŒì¼
- `FIRESTORE_RULES.md`: ìƒì„¸ ê·œì¹™ ì„¤ëª…
- `FIREBASE_SETUP.md`: Firebase ì´ˆê¸° ì„¤ì • ê°€ì´ë“œ

