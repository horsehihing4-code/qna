# ê³µê°œ ì ‘ê·¼ Firestore ë³´ì•ˆ ê·œì¹™

## ðŸ“‹ ê·œì¹™ ì„¤ëª…

ì´ ê·œì¹™ì€ **ëˆ„êµ¬ë‚˜ ì§ˆë¬¸ì„ ì˜¬ë¦¬ê³  ë‹µë³€ì„ ì˜¬ë¦´ ìˆ˜ ìžˆë„ë¡** êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

### âœ… í—ˆìš©ë˜ëŠ” ìž‘ì—…

1. **ì½ê¸°**: ëª¨ë“  ì‚¬ìš©ìžê°€ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ì½ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤
2. **ì§ˆë¬¸ ìž‘ì„±**: ëˆ„êµ¬ë‚˜ ìƒˆ ì§ˆë¬¸ì„ ìž‘ì„±í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤
3. **ë‹µë³€ ìž‘ì„±**: ëˆ„êµ¬ë‚˜ ê¸°ì¡´ ì§ˆë¬¸ì— ë‹µë³€ì„ ì¶”ê°€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤

### ðŸ”’ ë³´ì•ˆ ê¸°ëŠ¥

1. **ë°ì´í„° ê²€ì¦**: 
   - ì œëª©: 1-200ìž
   - ë‚´ìš©: 1-5000ìž
   - í•„ìˆ˜ í•„ë“œ í™•ì¸

2. **ë°ì´í„° ë³´í˜¸**:
   - ê¸°ì¡´ ì§ˆë¬¸ ë‚´ìš© ìˆ˜ì • ë¶ˆê°€
   - ì§ˆë¬¸/ë‹µë³€ ì‚­ì œ ë¶ˆê°€
   - ë‹µë³€ë§Œ ì¶”ê°€ ê°€ëŠ¥

---

## ðŸš€ ì ìš© ë°©ë²•

### 1ë‹¨ê³„: Firebase ì½˜ì†” ì ‘ì†

1. https://console.firebase.google.com/ ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. **Firestore Database** í´ë¦­
4. **ê·œì¹™** íƒ­ í´ë¦­

### 2ë‹¨ê³„: ê·œì¹™ ë³µì‚¬ ë° ë¶™ì—¬ë„£ê¸°

ì•„ëž˜ ê·œì¹™ì„ ë³µì‚¬í•˜ì—¬ Firebase ì½˜ì†”ì˜ ê·œì¹™ íŽ¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // questions ì»¬ë ‰ì…˜ ê·œì¹™
    match /questions/{subjectId}/items/{questionId} {
      // âœ… ëª¨ë“  ì‚¬ìš©ìžê°€ ì½ê¸° ê°€ëŠ¥
      allow read: if true;
      
      // âœ… ëˆ„êµ¬ë‚˜ ì§ˆë¬¸ ìž‘ì„± ê°€ëŠ¥ (ë°ì´í„° ê²€ì¦ í¬í•¨)
      allow create: if request.resource.data.keys().hasAll(['title', 'content', 'createdAt', 'answers'])
                    && request.resource.data.title is string
                    && request.resource.data.title.size() > 0
                    && request.resource.data.title.size() <= 200
                    && request.resource.data.content is string
                    && request.resource.data.content.size() > 0
                    && request.resource.data.content.size() <= 5000
                    && request.resource.data.answers is list;
      
      // âœ… ëˆ„êµ¬ë‚˜ ë‹µë³€ ì¶”ê°€ ê°€ëŠ¥ (ë‹µë³€ë§Œ ì¶”ê°€, ê¸°ì¡´ ë°ì´í„° ìˆ˜ì • ë¶ˆê°€)
      allow update: if request.resource.data.diff(resource.data).affectedKeys().hasOnly(['answers'])
                     && request.resource.data.answers.size() > resource.data.answers.size()
                     // ë‹µë³€ ë°ì´í„° ê²€ì¦
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].keys().hasAll(['id', 'content', 'createdAt'])
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content is string
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content.size() > 0
                     && request.resource.data.answers[request.resource.data.answers.size() - 1].content.size() <= 5000;
      
      // âŒ ì‚­ì œëŠ” í—ˆìš©í•˜ì§€ ì•ŠìŒ (ì•…ì˜ì ì¸ ì‚­ì œ ë°©ì§€)
      allow delete: if false;
    }
  }
}
```

### 3ë‹¨ê³„: ê·œì¹™ ê²Œì‹œ

1. **"ê²Œì‹œ"** ë²„íŠ¼ í´ë¦­
2. í™•ì¸ ë©”ì‹œì§€ì—ì„œ **"ê²Œì‹œ"** í´ë¦­
3. ì™„ë£Œ! ðŸŽ‰

---

## ðŸ“ ê·œì¹™ ìƒì„¸ ì„¤ëª…

### ì½ê¸° ê·œì¹™
```javascript
allow read: if true;
```
- ëª¨ë“  ì‚¬ìš©ìžê°€ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ì½ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤
- ì¸ì¦ ì—†ì´ë„ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤

### ì§ˆë¬¸ ìž‘ì„± ê·œì¹™
```javascript
allow create: if ...
```
- ëˆ„êµ¬ë‚˜ ìƒˆ ì§ˆë¬¸ì„ ìž‘ì„±í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤
- ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤:
  - í•„ìˆ˜ í•„ë“œ: title, content, createdAt, answers
  - ì œëª©: 1-200ìž
  - ë‚´ìš©: 1-5000ìž
  - answersëŠ” ë°°ì—´ì´ì–´ì•¼ í•¨

### ë‹µë³€ ì¶”ê°€ ê·œì¹™
```javascript
allow update: if ...
```
- ëˆ„êµ¬ë‚˜ ê¸°ì¡´ ì§ˆë¬¸ì— ë‹µë³€ì„ ì¶”ê°€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤
- ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•©ë‹ˆë‹¤:
  - answers í•„ë“œë§Œ ìˆ˜ì • ê°€ëŠ¥
  - ë‹µë³€ì€ ì¶”ê°€ë§Œ ê°€ëŠ¥ (ê¸°ì¡´ ë‹µë³€ ìˆ˜ì • ë¶ˆê°€)
  - ìƒˆ ë‹µë³€ ë‚´ìš©: 1-5000ìž

### ì‚­ì œ ê·œì¹™
```javascript
allow delete: if false;
```
- ì§ˆë¬¸ê³¼ ë‹µë³€ ì‚­ì œëŠ” ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤
- ì•…ì˜ì ì¸ ì‚­ì œë¥¼ ë°©ì§€í•©ë‹ˆë‹¤

---

## âœ… í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì§ˆë¬¸ ìž‘ì„± í…ŒìŠ¤íŠ¸
1. ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì§ˆë¬¸ ìž‘ì„±
2. Firebase ì½˜ì†” â†’ Firestore â†’ ë°ì´í„° íƒ­ì—ì„œ í™•ì¸
3. ì§ˆë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì €ìž¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 2. ë‹µë³€ ìž‘ì„± í…ŒìŠ¤íŠ¸
1. ì§ˆë¬¸ í´ë¦­í•˜ì—¬ ìƒì„¸ íŽ˜ì´ì§€ ì´ë™
2. ë‹µë³€ ìž‘ì„±
3. Firebase ì½˜ì†”ì—ì„œ answers ë°°ì—´ì— ë‹µë³€ì´ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 3. ì½ê¸° í…ŒìŠ¤íŠ¸
1. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë‚˜ ì‹œí¬ë¦¿ ëª¨ë“œì—ì„œ ì ‘ì†
2. ì§ˆë¬¸ ëª©ë¡ì´ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
3. ì§ˆë¬¸ ìƒì„¸ íŽ˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

## ðŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ: "Permission denied" ì˜¤ë¥˜

**ì›ì¸**: ê·œì¹™ì´ ìš”ì²­ì„ ê±°ë¶€í•¨

**í•´ê²°**:
1. ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ê²Œì‹œë˜ì—ˆëŠ”ì§€ í™•ì¸
2. ê·œì¹™ ë¬¸ë²• ì˜¤ë¥˜ í™•ì¸
3. ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸

### ë¬¸ì œ: ì§ˆë¬¸ì€ ë˜ëŠ”ë° ë‹µë³€ì´ ì•ˆ ë¨

**ì›ì¸**: update ê·œì¹™ì´ ë„ˆë¬´ ì œí•œì ì¼ ìˆ˜ ìžˆìŒ

**í•´ê²°**:
1. ê·œì¹™ì˜ update ì¡°ê±´ í™•ì¸
2. ë‹µë³€ ë°ì´í„° êµ¬ì¡°ê°€ ê·œì¹™ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
3. ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ í™•ì¸

### ë¬¸ì œ: ê·œì¹™ ê²Œì‹œê°€ ì•ˆ ë¨

**ì›ì¸**: ë¬¸ë²• ì˜¤ë¥˜

**í•´ê²°**:
1. ê·œì¹™ íŽ¸ì§‘ê¸°ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
2. ê´„í˜¸, ë”°ì˜´í‘œ í™•ì¸
3. ìœ„ì˜ ê·œì¹™ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©

---

## ðŸ’¡ ì¶”ê°€ ì •ë³´

### ë°ì´í„° êµ¬ì¡°
```
questions/
  â”œâ”€â”€ korean/
  â”‚   â””â”€â”€ items/
  â”‚       â””â”€â”€ {questionId}/
  â”‚           â”œâ”€â”€ title: "ì§ˆë¬¸ ì œëª©"
  â”‚           â”œâ”€â”€ content: "ì§ˆë¬¸ ë‚´ìš©"
  â”‚           â”œâ”€â”€ createdAt: Timestamp
  â”‚           â””â”€â”€ answers: [
  â”‚                 {
  â”‚                   id: "ë‹µë³€ID",
  â”‚                   content: "ë‹µë³€ ë‚´ìš©",
  â”‚                   createdAt: Timestamp
  â”‚                 }
  â”‚               ]
  â”œâ”€â”€ english/
  â”œâ”€â”€ math/
  â””â”€â”€ science/
```

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ë°ì´í„° ê²€ì¦**: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ì–‘ìª½ì—ì„œ ê²€ì¦
2. **ì‚­ì œ ë°©ì§€**: ì•…ì˜ì ì¸ ì‚­ì œ ë°©ì§€
3. **ìˆ˜ì • ë°©ì§€**: ê¸°ì¡´ ì§ˆë¬¸/ë‹µë³€ ë‚´ìš© ìˆ˜ì • ë¶ˆê°€
4. **í¬ê¸° ì œí•œ**: ë¹„ìš© ì ˆê° ë° ì„±ëŠ¥ ìµœì í™”

---

## ðŸ“š ê´€ë ¨ ë¬¸ì„œ

- `firestore.rules`: ì´ ê·œì¹™ íŒŒì¼
- `FIRESTORE_RULES.md`: ë‹¤ë¥¸ ê·œì¹™ ì˜µì…˜ ì„¤ëª…
- `APPLY_FIRESTORE_RULES.md`: ê·œì¹™ ì ìš© ê°€ì´ë“œ

